package com.pku.xiaoyoubang.view;import java.util.ArrayList;import android.os.Bundle;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentActivity;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentStatePagerAdapter;import android.support.v4.view.ViewPager.OnPageChangeListener;import android.view.Window;import android.widget.TextView;import com.nostra13.universalimageloader.core.ImageLoader;import com.pku.xiaoyoubang.R;import com.pku.xiaoyoubang.selfview.ImageDetailFragment;import com.pku.xiaoyoubang.selfview.MyViewPager;import com.pku.xiaoyoubang.tool.MyApplication;public class ViewPictureActivity extends FragmentActivity {	private MyViewPager mPager;	private int pagerPosition;	private TextView indicator;	private ArrayList< String > pictureList;		public void onCreate( Bundle savedInstanceState ) 	{		super.onCreate( savedInstanceState );		requestWindowFeature( Window.FEATURE_NO_TITLE );		MyApplication.getInstance().addActivity( this );		setContentView( R.layout.view_picture );		pagerPosition = getIntent().getIntExtra( "index", 0 );		pictureList = getIntent().getStringArrayListExtra( "pictureListBig" );		mPager = ( MyViewPager ) findViewById( R.id.view_picture_pager );		ImagePagerAdapter mAdapter = new ImagePagerAdapter( getSupportFragmentManager(), pictureList );		mPager.setAdapter( mAdapter );				indicator = ( TextView ) findViewById( R.id.view_picture_indicator );		indicator.setText( ( pagerPosition + 1 ) + "/" + pictureList.size() );		mPager.setOnPageChangeListener		(			new OnPageChangeListener() 			{				public void onPageScrollStateChanged( int arg0 ) {}				public void onPageScrolled( int arg0, float arg1, int arg2 ) {}				public void onPageSelected( int arg0 ) 				{					indicator.setText( ( arg0 + 1 ) + "/" + pictureList.size() );				}			}		);		if( savedInstanceState != null ) 		{			pagerPosition = savedInstanceState.getInt( "STATE_POSITION" );		}		mPager.setCurrentItem( pagerPosition );	}	public void onSaveInstanceState( Bundle outState ) 	{		outState.putInt( "STATE_POSITION", mPager.getCurrentItem() );	}	private class ImagePagerAdapter extends FragmentStatePagerAdapter 	{		private ArrayList< String > pictureList;		public ImagePagerAdapter( FragmentManager fm, ArrayList< String > pictureList ) 		{			super( fm );			this.pictureList = pictureList;		}		public int getCount() 		{			return pictureList == null ? 0 : pictureList.size();		}		public Fragment getItem( int position ) 		{			String url = pictureList.get( position );			return ImageDetailFragment.newInstance( url );		}	}		public void onDestroy()	{		super.onDestroy();		ImageLoader.getInstance().clearMemoryCache();	}}